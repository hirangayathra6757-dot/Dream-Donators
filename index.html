<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dream Donators — By GCC Media</title>
  <style>
    :root{--bg:#f2f6ff;--bg2:#dce7ff;--card:#ffffff;--text:#2b2d42;--muted:#6b7280;--accent:#2563eb;--accent2:#3b82f6;--radius:20px;--shadow:0 10px 30px rgba(0,0,0,0.08);font-family:'Poppins',sans-serif}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text)}
    header{position:sticky;top:0;padding:14px 20px;background:rgba(255,255,255,0.7);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,0.4);z-index:50}
    .nav{max-width:1200px;margin:auto;display:flex;justify-content:space-between;align-items:center}
    .logo{width:50px;height:50px;border-radius:15px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:white;box-shadow:0 6px 18px rgba(37,99,235,0.3)}
    nav a{text-decoration:none;margin-left:18px;font-weight:600;color:var(--text)}
    nav a:hover{color:var(--accent)}
    .hero{max-width:1200px;margin:40px auto;display:grid;grid-template-columns:1fr 1fr;gap:30px;align-items:center;padding:0 20px}
    .hero-text h1{font-size:40px;margin:0 0 12px;color:var(--accent)}
    .hero-img{width:100%;height:360px;border-radius:var(--radius);box-shadow:var(--shadow);background-size:cover;background-position:center;border:1px solid #ddd;display:block}
    .btn{padding:12px 20px;background:var(--accent);border-radius:var(--radius);border:0;color:white;font-weight:700;cursor:pointer;box-shadow:0 8px 20px rgba(37,99,235,0.28);transition:.25s}
    .btn:hover{background:var(--accent2)}
    .card{background:white;border-radius:var(--radius);box-shadow:var(--shadow);padding:26px;margin:20px auto}
    label{font-size:14px;font-weight:600;color:var(--text)}
    input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #d9d9d9;margin-top:6px;background:#f9fbff}
    .donor-item{display:flex;gap:15px;background:#f7faff;padding:14px;border-radius:var(--radius);align-items:center;box-shadow:0 1px 4px rgba(0,0,0,0.08)}
    .avatar{width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,#93c5fd,#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
    footer{margin-top:50px;text-align:center;color:#6b7280;padding:30px}
    @media(max-width:900px){.hero{grid-template-columns:1fr}.hero-img{height:260px}}
    .fade-in{animation:fadeIn .7s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
    .admin-panel{display:none}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <div style="display:flex;gap:12px;align-items:center"><div class="logo">DD</div><div><strong>Dream Donators</strong><div style="font-size:12px;color:var(--muted)">By GCC Media</div></div></div>
    <nav>
      <a href="#home" onclick="scrollToSection('home')">Home</a>
      <a href="#donate" onclick="scrollToSection('donate')">Donate</a>
      <a href="#help" onclick="scrollToSection('help')">Student Help</a>
      <a href="#wall" onclick="scrollToSection('wall')">Donor Wall</a>
      <a href="#about" onclick="scrollToSection('about')">About</a>
      <a href="#contact" onclick="scrollToSection('contact')">Contact</a>
      <a href="#admin" onclick="scrollToSection('admin')">Admin</a>
    </nav>
  </div>
</header>

<section class="hero fade-in" id="home">
  <div class="hero-text">
    <h1>Be the reason a child smiles again</h1>
    <p class="muted" style="font-size:16px;line-height:1.6">Your donation of school uniforms, books, shoes, or bags helps students in Sri Lanka continue their education with dignity.</p>
    <button class="btn" onclick="scrollToSection('donate')">Donate Now</button>
  </div>
  <div class="hero-img" id="heroImg"></div>
</section>

<section id="donate" style="max-width:900px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="margin:0 0 12px;color:var(--accent)">Make a Donation</h2>
    <form id="donationForm">
      <label>Full Name *</label>
      <input id="name" required>
      <label style="margin-top:14px">Email *</label>
      <input id="email" required>
      <label style="margin-top:14px">Phone *</label>
      <input id="phone" required>
      <label style="margin-top:14px">Donation Type *</label>
      <select id="type">
        <option>Uniforms</option><option>Books</option><option>Shoes</option><option>Bags</option><option>Sponsor</option>
      </select>
      <label style="margin-top:14px">Quantity / Details</label>
      <input id="qty" placeholder="e.g. 2 uniforms size 12">
      <button class="btn" type="submit" style="margin-top:18px">Submit Donation</button>
      <div id="formMsg" style="margin-top:10px;color:var(--muted);font-size:14px"></div>
    </form>
  </div>
</section>

<section id="help" style="max-width:900px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">Request Help (Students)</h2>
    <form id="helpForm">
      <label>Student Name *</label>
      <input id="sname" required>
      <label style="margin-top:14px">School *</label>
      <input id="school" required>
      <label style="margin-top:14px">District *</label>
      <input id="sdistrict" required>
      <label style="margin-top:14px">What do you need? *</label>
      <textarea id="need" rows="4"></textarea>
      <button class="btn" type="submit" style="margin-top:16px">Submit Request</button>
      <div id="helpMsg" style="margin-top:10px;color:var(--muted);font-size:14px"></div>
    </form>
  </div>
</section>

<section id="wall" style="max-width:900px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">Recent Donors</h2>
    <div id="publicWall" style="margin-top:14px"></div>
  </div>
</section>

<section id="about" style="max-width:900px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">About Our Mission</h2>
    <p class="muted">Our mission is to empower students across Sri Lanka by providing essential school supplies and support, ensuring every child can learn and thrive.</p>
  </div>
</section>

<section id="contact" style="max-width:900px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">Contact Us</h2>
    <p class="muted">Phone: +94 77 123 4567 | Email: contact@dreamdonators.lk</p>
  </div>
</section>

<section id="admin" style="max-width:500px;margin:auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">Admin Login</h2>
    <label>Username</label>
    <input id="adminUser">
    <label style="margin-top:14px">Password</label>
    <input id="adminPass" type="password">
    <button class="btn" style="margin-top:16px" onclick="adminLogin()">Login</button>
    <div id="adminMsg" style="margin-top:10px;color:red"></div>
  </div>
</section>

<!-- Admin Panel (hidden until login) -->
<section id="adminPanel" class="admin-panel" style="max-width:1100px;margin:18px auto;padding:0 20px">
  <div class="card fade-in">
    <h2 style="color:var(--accent)">Administrator Dashboard</h2>
    <div style="display:flex;gap:18px;flex-wrap:wrap">
      <div style="flex:1;min-width:320px">
        <h3>All Donators</h3>
        <div id="allDonors"></div>
      </div>
      <div style="flex:1;min-width:320px">
        <h3>All Student Requests</h3>
        <div id="allRequests"></div>
      </div>
    </div>
    <div style="margin-top:12px">
      <button class="btn" onclick="exportCSV()">Export Donors CSV</button>
      <button class="btn" style="background:#ef4444;margin-left:8px" onclick="logout()">Logout</button>
    </div>
  </div>
</section>

<footer>© Dream Donators — By GCC Media</footer>

<script type="module">
  // Firebase imports
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
  import { getAuth, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

  const firebaseConfig = {
    apiKey: "AIzaSyAVUIIwFXEsOmOS96lifn_aEccV3I35bWU",
    authDomain: "dream-donators.firebaseapp.com",
    projectId: "dream-donators",
    storageBucket: "dream-donators.firebasestorage.app",
    messagingSenderId: "943510265596",
    appId: "1:943510265596:web:25e49411973c046bf50179",
    measurementId: "G-KJ1WWR3TJH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Utility: escape HTML
  function esc(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

  // Render public donor wall from Firestore
  async function renderPublicWall(){
    const wall = document.getElementById('publicWall');
    wall.innerHTML = '<div class="muted">Loading...</div>';
    try{
      const q = query(collection(db,'donators'), orderBy('date','desc'));
      const snap = await getDocs(q);
      if(snap.empty){ wall.innerHTML = '<div class="muted">No donations yet.</div>'; return }
      wall.innerHTML = '';
      snap.forEach(doc=>{
        const d = doc.data();
        const el = document.createElement('div'); el.className='donor-item';
        el.innerHTML = `<div class="avatar">${esc((d.name||'G').slice(0,2))}</div><div><strong>${esc(d.name)}</strong><div class="muted">${esc(d.type)} • ${esc(d.qty||'')}</div></div>`;
        wall.appendChild(el);
      })
    }catch(err){ wall.innerHTML = '<div class="muted">Failed to load donors.</div>'; console.error(err) }
  }

  // Donation form submit
  document.getElementById('donationForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const type = document.getElementById('type').value;
    const qty = document.getElementById('qty').value.trim();
    const msgEl = document.getElementById('formMsg');
    if(!name||!email||!phone){ msgEl.textContent='Please fill required fields.'; return }
    msgEl.textContent='Saving...';
    try{
      await addDoc(collection(db,'donators'),{name,email,phone,type,qty,date:new Date()});
      msgEl.textContent='Thank you — donation recorded.';
      document.getElementById('donationForm').reset();
      renderPublicWall();
    }catch(err){ msgEl.textContent='Failed to save; try later.'; console.error(err) }
  });

  // Help request submit
  document.getElementById('helpForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const sname = document.getElementById('sname').value.trim();
    const school = document.getElementById('school').value.trim();
    const district = document.getElementById('sdistrict').value.trim();
    const need = document.getElementById('need').value.trim();
    const msgEl = document.getElementById('helpMsg');
    if(!sname||!school||!district||!need){ msgEl.textContent='Please fill required fields.'; return }
    msgEl.textContent='Saving...';
    try{
      await addDoc(collection(db,'students'),{sname,school,district,need,date:new Date()});
      msgEl.textContent='Request submitted — we will review it.';
      document.getElementById('helpForm').reset();
    }catch(err){ msgEl.textContent='Failed to save; try later.'; console.error(err) }
  });

  // Admin login: try Firebase Auth with email; fallback to local username/password (Hiran)
  window.adminLogin = async function(){
    const u = document.getElementById('adminUser').value.trim();
    const p = document.getElementById('adminPass').value;
    const msg = document.getElementById('adminMsg'); msg.textContent='';
    // Try firebase auth assuming u is email
    try{
      if(u.includes('@')){
        await signInWithEmailAndPassword(auth,u,p);
        showAdminPanel();
        return;
      }
    }catch(err){ console.log('firebase auth failed',err); }
    // fallback to local check
    if(u==='Hiran' && p==='Hiran@6757'){
      showAdminPanel();
    } else {
      msg.textContent='Invalid login';
    }
  }

  // Show admin panel and load data
  async function showAdminPanel(){
    document.getElementById('adminMsg').textContent='';
    document.getElementById('admin').scrollIntoView({behavior:'smooth'});
    document.getElementById('adminPanel').style.display='block';
    document.getElementById('admin').style.display='none';
    // load donors and students
    loadAdminData();
  }

  async function loadAdminData(){
    const donorsEl = document.getElementById('allDonors'); donorsEl.innerHTML='Loading...';
    const studentsEl = document.getElementById('allRequests'); studentsEl.innerHTML='Loading...';
    try{
      const dSnap = await getDocs(query(collection(db,'donators'), orderBy('date','desc')));
      const sSnap = await getDocs(query(collection(db,'students'), orderBy('date','desc')));
      if(dSnap.empty) donorsEl.innerHTML='<div class="muted">No donors yet.</div>';
      else donorsEl.innerHTML = dSnap.docs.map(doc=>{
        const d=doc.data(); return `<div style="padding:8px;border-bottom:1px solid #f0f4ff"><strong>${esc(d.name)}</strong><div class=\"muted\">${esc(d.type)} • ${esc(d.qty||'')} • ${esc(d.email||'')}</div></div>`;
      }).join('');
      if(sSnap.empty) studentsEl.innerHTML='<div class="muted">No requests yet.</div>';
      else studentsEl.innerHTML = sSnap.docs.map(doc=>{
        const s=doc.data(); return `<div style="padding:8px;border-bottom:1px solid #f0f4ff"><strong>${esc(s.sname)}</strong><div class=\"muted\">${esc(s.need)} • ${esc(s.school)} • ${esc(s.district)}</div></div>`;
      }).join('');
    }catch(err){ donorsEl.innerHTML='Failed to load'; studentsEl.innerHTML='Failed to load'; console.error(err) }
  }

  // Export donors CSV
  function exportCSV(){
    // require adminPanel visible
    const dSnapPromise = getDocs(query(collection(db,'donators'), orderBy('date','desc')));
    dSnapPromise.then(snap=>{
      if(snap.empty){ alert('No donors'); return }
      const headers=['name','email','phone','type','qty','date'];
      const rows = snap.docs.map(doc=>{
        const d = doc.data(); return [d.name||'',d.email||'',d.phone||'',d.type||'',d.qty||'', (d.date && d.date.toDate) ? d.date.toDate().toISOString() : (d.date?d.date.toString(): '')];
      });
      // build CSV safely using \n for newlines
      let csv = headers.join(',') + '\n' + rows.map(r => r.map(c => '"' + String(c).replace(/"/g, '""') + '"').join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='donors.csv'; a.click(); URL.revokeObjectURL(url);
    }).catch(err=>{alert('Export failed'); console.error(err)});
  }

  // Logout
  async function logout(){
    try{ await signOut(auth); }catch(e){/*ignore*/}
    document.getElementById('adminPanel').style.display='none';
    document.getElementById('admin').style.display='block';
    document.getElementById('adminUser').value=''; document.getElementById('adminPass').value='';
    alert('Logged out');
  }

  // helper: scroll
  function scrollToSection(id){ const el = document.getElementById(id); if(el) el.scrollIntoView({behavior:'smooth'}); }

  // initial render
  renderPublicWall();

</script>

</body>
</html>
